%% FLURM Migration Configuration
%% Used for testing hot migration from SLURM

[
    %% FLURM Core Configuration
    {flurm_core, [
        {cluster_name, <<"migration-test">>},

        %% Import settings
        {slurm_import, [
            {enabled, true},
            {controller_host, <<"slurm-controller">>},
            {controller_port, 6817},
            {sync_interval, 5000},
            {auto_sync, true}
        ]},

        %% Shadow mode configuration
        {shadow_mode, [
            {enabled, true},
            {passthrough, true},  % Pass commands to SLURM initially
            {sync_on_start, true}
        ]}
    ]},

    %% FLURM Controller Configuration
    {flurm_controller, [
        {listen_port, 6820},
        {http_port, 8080},

        %% Partition defaults
        {partitions, [
            {<<"debug">>, #{
                nodes => [<<"compute-node-1">>],
                default => true,
                max_time => 1800  % 30 minutes
            }},
            {<<"batch">>, #{
                nodes => [<<"compute-node-1">>],
                max_time => 86400  % 24 hours
            }},
            {<<"gpu">>, #{
                nodes => [<<"compute-node-1">>],
                max_time => 172800  % 48 hours
            }}
        ]}
    ]},

    %% FLURM Database (Ra) Configuration
    {flurm_db, [
        {data_dir, "/var/lib/flurm/ra"},
        {cluster_name, flurm_cluster}
    ]},

    %% Prometheus Metrics
    {prometheus, [
        {collectors, [
            prometheus_boolean,
            prometheus_counter,
            prometheus_gauge,
            prometheus_histogram,
            prometheus_summary
        ]}
    ]},

    %% Logging Configuration
    {lager, [
        {handlers, [
            {lager_console_backend, [{level, info}]},
            {lager_file_backend, [
                {file, "/var/log/flurm/flurm.log"},
                {level, info},
                {size, 10485760},
                {date, "$D0"},
                {count, 5}
            ]}
        ]},
        {error_logger_redirect, true}
    ]}
].
