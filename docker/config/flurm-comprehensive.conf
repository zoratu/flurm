%% FLURM Comprehensive Test Configuration
%% Used for testing all FLURM features in docker-compose.comprehensive-test.yml

[
    %% FLURM Core Configuration
    {flurm_core, [
        {cluster_name, <<"flurm-test-cluster">>},

        %% HA Configuration
        {ha_enabled, true},
        {ra_data_dir, "/var/lib/flurm/ra"},

        %% SLURM Bridge (for migration testing)
        {slurm_bridge, [
            {enabled, false},  % Start in standalone mode
            {controller_host, <<"slurm-controller">>},
            {controller_port, 6817}
        ]}
    ]},

    %% FLURM Controller Configuration
    {flurm_controller, [
        {listen_port, 6817},
        {http_port, 9090},
        {rest_port, 8080},

        %% Partition definitions for comprehensive testing
        {partitions, [
            {<<"debug">>, #{
                nodes => [<<"flurm-node-small">>],
                default => true,
                max_time => 1800  % 30 minutes
            }},
            {<<"small">>, #{
                nodes => [<<"flurm-node-small">>],
                max_time => 3600  % 1 hour
            }},
            {<<"batch">>, #{
                nodes => [<<"flurm-node-small">>, <<"flurm-node-medium">>, <<"flurm-node-large">>],
                max_time => 86400  % 24 hours
            }},
            {<<"medium">>, #{
                nodes => [<<"flurm-node-medium">>],
                max_time => 86400
            }},
            {<<"large">>, #{
                nodes => [<<"flurm-node-large">>],
                max_time => 172800  % 48 hours
            }},
            {<<"gpu">>, #{
                nodes => [<<"flurm-node-gpu">>],
                max_time => 172800,
                gres => [<<"gpu:2">>]
            }}
        ]}
    ]},

    %% FLURM Node Daemon Configuration
    {flurm_node_daemon, [
        {controller_host, <<"flurm-ctrl-1">>},
        {controller_port, 6817}
    ]},

    %% FLURM Database (Ra) Configuration
    {flurm_db, [
        {data_dir, "/var/lib/flurm/ra"},
        {cluster_name, flurm_cluster}
    ]},

    %% Prometheus Metrics
    {prometheus, [
        {collectors, [
            prometheus_boolean,
            prometheus_counter,
            prometheus_gauge,
            prometheus_histogram,
            prometheus_summary
        ]}
    ]},

    %% Logging Configuration
    {lager, [
        {handlers, [
            {lager_console_backend, [{level, info}]},
            {lager_file_backend, [
                {file, "/var/log/flurm/flurm.log"},
                {level, info},
                {size, 10485760},
                {date, "$D0"},
                {count, 5}
            ]}
        ]},
        {error_logger_redirect, true}
    ]}
].
