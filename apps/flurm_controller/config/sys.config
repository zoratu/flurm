%% -*- mode: erlang; -*-
%% FLURM Controller Cluster Configuration
%%
%% This is a sample configuration for a 3-node FLURM controller cluster.
%% Copy this file and modify for your environment.
%%
%% To enable cluster mode:
%% 1. Start each node with a unique name: erl -name flurm@ctrl1.example.com
%% 2. Configure cluster_nodes to include all controller nodes
%% 3. Ensure all nodes can communicate (same Erlang cookie)
%%

[
    {flurm_controller, [
        %% Network listener configuration
        {listen_port, 6817},
        {listen_address, "0.0.0.0"},
        {num_acceptors, 10},
        {max_connections, 1000},

        %% Cluster configuration
        %% Set to a list of all controller nodes for HA mode
        %% Example: ['flurm@ctrl1.example.com', 'flurm@ctrl2.example.com', 'flurm@ctrl3.example.com']
        {cluster_name, flurm},
        {cluster_nodes, ['flurm@ctrl1', 'flurm@ctrl2', 'flurm@ctrl3']},

        %% Ra (Raft consensus) data directory
        %% Each node needs its own directory (can be on local disk)
        {ra_data_dir, "/var/lib/flurm/ra"},

        %% Cluster timeouts (milliseconds)
        {leader_check_interval, 1000},  %% How often to check leader status
        {forward_timeout, 5000},        %% Timeout for forwarding requests to leader
        {election_timeout, 5000}        %% Timeout for leader election
    ]},

    {ra, [
        {data_dir, "/var/lib/flurm/ra"}
    ]},

    {lager, [
        {handlers, [
            {lager_console_backend, [{level, info}]},
            {lager_file_backend, [
                {file, "/var/log/flurm/controller.log"},
                {level, info},
                {size, 10485760},
                {date, "$D0"},
                {count, 10}
            ]}
        ]}
    ]},

    {kernel, [
        %% Distributed Erlang configuration
        %% Uncomment and set for cluster mode
        %% {inet_dist_listen_min, 9100},
        %% {inet_dist_listen_max, 9200},
        {logger_level, info}
    ]}
].
